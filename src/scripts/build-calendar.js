// scripts/build-calendar.js
import fs from 'fs';
import path from 'path';

const inputPath = './src/data/hours.txt';
const outputPath = './public/js/calendarData.js';

const text = fs.readFileSync(inputPath, 'utf-8').trim();
const lines = text.split('\n');

const result = {};


for (const line of lines) {
  const [startDate, endDate, startTime, endTime, memo] = line.split('\t');

  let current = new Date(startDate);
  const last = new Date(endDate);

  while (current <= last) {
    const dateStr = current.toISOString().split('T')[0];

    const [startH] = startTime.split(':');  
    const [endH] = endTime.split(':');
    
    result[dateStr] = `${startH} - ${endH} pm`;
    //result[dateStr] = `${startTime} - ${endTime}`;
    // Move to next day
    current.setDate(current.getDate() + 1);
  }
}

// Generate the output JS file
const fileContent = `
// This file is generated by build-calendar.js

const calendarHours = ${JSON.stringify(result, null, 2)};

export function getHoursForToday() {
  const today = new Date().toISOString().split('T')[0];
  const hours = calendarHours[today];  
  if(hours)
    return ['Hours: <b class="mr-1">', hours, '</b><span class="face"></span>'].join('');
  else 'Closed Today <span class="emoji">ðŸ˜­</span>';
}
`;

fs.writeFileSync(outputPath, fileContent);

console.log(`âœ… Generated ${outputPath}`);
